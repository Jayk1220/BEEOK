{% extends "layout.html" %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/4.customer/customer.css') }}">

<div class="customer-wrapper">
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            {% for message in messages %}
                <div class="alert-banner auto-dismiss">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <div class="page-header">
        <h2><i class="bi bi-people-fill me-2"></i>고객 및 협력사 관리</h2>
        <a href="{{ url_for('customer.customer_registration') }}" class="btn-add">+ 신규 고객 등록</a>
    </div>

    <section class="search-section">
        <form action="{{ url_for('customer.list_customer') }}" method="GET" class="search-form">
            <div class="search-group">
                <label>기본 정보</label>
                <input type="text" name="names" class="search-input" value="{{ names }}" placeholder="ID, 고객명, 상호명...">
            </div>

            <div class="search-group">
                <label>연락처 정보</label>
                <input type="text" name="contact" class="search-input" value="{{ contact }}" placeholder="이메일, 전화번호...">
            </div>

            <div class="search-group">
                <label>거래 상태</label>
                <select name="status" class="search-select">
                    <option value="">-- 상태 전체 --</option>
                    {% for s in status_list %}
                    <option value="{{ s }}" {% if status == s %}selected{% endif %}>{{ s }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="search-group">
                <label>구분</label>
                <select name="class_" class="search-select">
                    <option value="">-- 구분 전체 --</option>
                    {% for c in class_list %}
                    <option value="{{ c }}" {% if class_ == c %}selected{% endif %}>{{ c }}</option>
                    {% endfor %}
                </select>
            </div>

            <button type="submit" class="btn-search">검색</button>
        </form>
    </section>

    <div class="customer-table-container">
        <table class="customer-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>상호명</th>
                    <th>담당자</th>
                    <th>연락처 / 이메일</th>
                    <th>등록일</th>
                    <th>구분</th>
                    <th>상태</th>
                    <th>관리</th>
                </tr>
            </thead>
            <tbody>
                {% for c in customers %}
                <tr>
                    <td><code>{{ c.CUSTOMER_ID }}</code></td>
                    <td style="text-align: center;"> {{ c.COMPANY_NAME or '-' }}</td>
                    <td style="text-align: center;"> {{ c.CONTACT_PERSON }}</td>
                    <td> {{ c.CONTACT }}<br>
                        <small class="text-muted">{{ c.EMAIL or '-' }}</small>
                    </td>
                    <td>{{ c.REG_DATE }}</td>
                    <td><span class="class-badge">{{ c.CLASS }}</span></td>
                    <td>
                        <span class="status-badge status-{{ c.STATUS }}">
                            {{ c.STATUS }}
                        </span>
                    </td>
                    <td>
                        <div class="action-buttons">
                            <a href="{{ url_for('customer.customer_info', customer_id=c.CUSTOMER_ID) }}" class="btn-detail">상세</a>
                            <a href="{{ url_for('customer.delete_customer', customer_id=c.CUSTOMER_ID) }}" class="btn-delete" onclick="return confirm('정말 삭제하시겠습니까?')">삭제</a>
                        </div>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="8" class="py-5 text-muted">일치하는 고객 정보가 없습니다.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
<script src="{{ url_for('static', filename='js/customer.js') }}"></script>
{% endblock %}