{% extends "layout.html" %}

{% block content %}
<div class="container mt-5 mb-5">
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        {% for message in messages %}
          <div class="alert alert-danger alert-dismissible fade show shadow-sm" role="alert">
            <i class="bi bi-exclamation-triangle-fill me-2"></i>
            <strong>알림:</strong> {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <div class="card shadow-lg border-0">
        <div class="card-header bg-primary text-white py-3">
            <h3 class="mb-0 fs-4"><i class="bi bi-box-seam me-2"></i>신규 제품 등록</h3>
        </div>
        <div class="card-body p-4">
            <form action="{{ url_for('product.product_registration') }}" method="POST" enctype="multipart/form-data">
                
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label fw-bold text-secondary">제품 ID</label>
                        <input type="text" name="product_id" class="form-control form-control-lg" placeholder="예: P001" required>
                        <div class="form-text">중복되지 않는 고유 ID를 입력하세요.</div>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label fw-bold text-secondary">제품명</label>
                        <input type="text" name="product_name" class="form-control form-control-lg" placeholder="제품명을 입력하세요" required>
                    </div>
                </div>

                <hr class="my-4">

                <div class="row g-3 mt-1">
                    <div class="col-md-6">
                        <label class="form-label fw-bold text-secondary">타겟 (Target)</label>
                        <input type="text" name="target" class="form-control" placeholder="예: 전문방역용, 일반가정용">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label fw-bold text-secondary">통화 단위</label>
                        <select name="currency" class="form-select">
                            <option value="KRW" selected>KRW (₩)</option>
                            <option value="USD">USD ($)</option>
                            <option value="JPY">JPY (¥)</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label fw-bold text-secondary">판매가 (외화)</label>
                        <div class="input-group">
                            <input type="number" step="0.01" name="price" class="form-control" value="0">
                        </div>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label fw-bold text-secondary">판매가 (KRW)</label>
                        <div class="input-group">
                            <span class="input-group-text">₩</span>
                            <input type="number" name="price_kor" class="form-control" value="0" required>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label fw-bold text-secondary">원가 (Cost)</label>
                        <div class="input-group">
                            <span class="input-group-text">₩</span>
                            <input type="number" name="cost" class="form-control" value="0" required>
                        </div>
                    </div>
                </div>

                <hr class="my-4">

                <div class="row g-3 mt-1">
                    <div class="col-12">
                        <label class="form-label fw-bold text-secondary">유튜브 홍보 영상 링크</label>
                        <input type="url" name="youtube" class="form-control" placeholder="https://www.youtube.com/watch?v=...">
                    </div>
                    <div class="col-12">
                        <label class="form-label fw-bold text-secondary">제품 이미지 업로드</label>
                        <input type="file" name="product_image" class="form-control" id="imageInput" accept="image/*">
                        <div id="imagePreview" class="mt-3 text-center p-3 border rounded bg-light">
                            <p class="text-muted small mb-2" id="previewText">이미지를 선택하면 여기에 미리보기가 표시됩니다.</p>
                            <img id="previewImg" src="#" alt="미리보기" style="max-width: 100%; max-height: 250px; display: none; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                        </div>
                    </div>
                </div>

                <div class="mt-4">
                    <label class="form-label fw-bold text-secondary">기타 메모</label>
                    <textarea name="memo" class="form-control" rows="4" placeholder="제품의 특징이나 상세 사양을 입력하세요."></textarea>
                </div>

                <div class="mt-5 d-flex justify-content-end gap-3">
                    <a href="{{ url_for('product.list_product') }}" class="btn btn-outline-secondary px-4">
                        <i class="bi bi-x-circle me-1"></i>취소
                    </a>
                    <button type="submit" class="btn btn-primary px-5 fw-bold">
                        <i class="bi bi-check-circle me-1"></i>제품 등록 완료
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    document.getElementById('imageInput').onchange = function (evt) {
        const [file] = this.files;
        const previewImg = document.getElementById('previewImg');
        const previewText = document.getElementById('previewText');
        
        if (file) {
            previewImg.src = URL.createObjectURL(file);
            previewImg.style.display = 'inline-block';
            previewText.style.display = 'none';
        } else {
            previewImg.style.display = 'none';
            previewText.style.display = 'block';
        }
    }
</script>
{% endblock %}