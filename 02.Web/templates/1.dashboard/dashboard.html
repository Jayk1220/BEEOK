{% extends "layout.html" %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/1.dashboard/dashboard.css') }}">

<div class="dashboard-wrapper">
    
    <section class="realtime-row">
        <div class="status-box">
            <span class="label">ğŸ ì „ì²´ ë²Œí†µ ìˆ˜</span>
            <span class="value">{{ hive.TOTAL_HIVE }}ê°œ</span>
        </div>
        <div class="status-box warning">
            <span class="label">ğŸš¨ ìƒíƒœ ì´ìƒ ë²Œí†µ</span>
            <span class="value">{{ hive.PROBLEM }}ê°œ</span>
        </div>
        <div class="status-box info">
            <span class="label">ğŸ“… ì¶”ê°€ ë‚´ìš©</span>
            <span class="value">ì¶”ê°€ ë‚´ìš©</span>
        </div>
    </section>

    <section class="filter-section">
        <form action="{{ url_for('dashboard.dashboard') }}" method="get" class="filter-form" id="filterForm">
            <div class="select-group">
                <label>ì—°ë„ ì„ íƒ</label>
                <select name="year" onchange="this.form.submit()">
                    {% for y in range(now_year-2, now_year+1) %}
                    <option value="{{ y }}" {{ 'selected' if y == select_year }}>{{ y }}ë…„</option>
                    {% endfor %}
                </select>
            </div>
            <div class="select-group">
                <label>ì›” ì„ íƒ</label>
                <select name="month" onchange="this.form.submit()">
                    <option value="ì „ì²´" {{ 'selected' if select_month == 'ì „ì²´' }}>ì „ì²´</option>
                    {% for m in range(1, 13) %}
                    <option value="{{ m }}" {{ 'selected' if m|string == select_month }}>{{ m }}ì›”</option>
                    {% endfor %}
                </select>
            </div>
            </form>
    </section>

    <div class="main-layout-grid">
        
        <aside class="panel side-panel">
            <div class="panel-header">
                <h3>â³ ë¯¸ì™„ë£Œ ì£¼ë¬¸ ({{ total.ORDER_QTY }}ê±´)</h3>
            </div>
            <div class="panel-body scrollable">
                <table class="list-table">
                    <thead>
                        <tr><th>ì£¼ë¬¸ë²ˆí˜¸</th><th>í˜„ì¬ìƒíƒœ</th></tr>
                    </thead>
                    <tbody>
                        {% for o in orders %}
                        <tr>
                            <td>{{ o.ORDER_ID }}</td>
                            <td><span class="status-badge">{{ o.STATUS }}</span></td>
                        </tr>
                        {% else %}
                        <tr><td colspan="2" class="no-data">ì§„í–‰ ì¤‘ì¸ ì£¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </aside>

        <main class="panel center-main">
            <div class="panel-header">
                <h3>ğŸ“ˆ ë§¤ì¶œ ì¶”ì´ (ì´ {{ "{:,.0f}".format(total.TOTAL_SALES) }}ì›)</h3>
            </div>
            <div class="panel-body chart-box">
                <canvas id="salesChart"></canvas>
            </div>
        </main>

        <aside class="panel side-panel">
            <div class="panel-header">
                <h3>ğŸ† ì œí’ˆë³„ íŒë§¤ëŸ‰ </h3>
            </div>
            <div class="panel-body scrollable">
                <table class="list-table">
                    <thead>
                        <tr><th>ì œí’ˆëª…</th><th>íŒë§¤ëŸ‰</th><th>ë§¤ì¶œì•¡</th></tr>
                    </thead>
                    <tbody>
                        {% for p in product %}
                        <tr>
                            <td>{{ p.product_name }}</td>
                            <td>{{ p.TOTAL_QTY }}</span></td>
                            <td>{{"{:,.0f}".format(p.TOTAL_SALES)}}ì›</td>
                        </tr>
                        {% else %}
                        <tr><td colspan="2" class="no-data">íŒë§¤ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <div class="panel-body">
                <ul class="ranking-list">
                    {% for r in rankings %}
                    <li>
                        <span class="rank">{{ loop.index }}</span>
                        <span class="name">{{ r.PRODUCT_NAME }}</span>
                        <span class="qty">{{ r.TOTAL_QTY }}ê°œ</span>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </aside>

    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('salesChart').getContext('2d');
    
    const labels = [{% for g in graph %}"{{ g.DAY }}ì¼",{% endfor %}];
    const salesData = [{% for g in graph %}{{ g.DAILY_SALES }},{% endfor %}];

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'ì¼ë³„ ë§¤ì¶œì•¡(ì›)',
                data: salesData,
                borderColor: '#f39c12',
                backgroundColor: 'rgba(243, 156, 18, 0.1)',
                fill: true,
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: { beginAtZero: true }
            }
        }
    });
</script>
{% endblock %}